<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Tracker - Threads VA</title>
    <style>
        :root {
            --primary: #8B5CF6;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --dark: #1F2937;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: var(--dark);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .nav-tabs {
            display: flex;
            background: #F3F4F6;
            border-bottom: 2px solid #E5E7EB;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .nav-tab.active {
            background: white;
            border-bottom: 3px solid var(--primary);
        }
        
        .tab-content {
            padding: 30px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        
        .card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .account-card {
            border-left: 4px solid var(--primary);
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .account-card.suspended {
            border-left-color: var(--danger);
        }
        
        .account-card.warmup {
            border-left-color: var(--warning);
        }
        
        .account-card.inactive {
            border-left-color: #6B7280;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-active {
            background: #D1FAE5;
            color: #065F46;
        }
        
        .status-suspended {
            background: #FEE2E2;
            color: #DC2626;
        }
        
        .status-warmup {
            background: #FEF3C7;
            color: #92400E;
        }
        
        .status-inactive {
            background: #F3F4F6;
            color: #6B7280;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.3s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: var(--dark);
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }
        
        .account-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .view-badge {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .performance-chart {
            background: #F8FAFC;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .nav-tab {
                min-width: 100px;
                font-size: 14px;
                padding: 12px 10px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .account-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>📊 Account Tracker</h1>
            <p>Monitor All Your Threads Accounts & Performance</p>
        </header>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">📈 Dashboard</button>
            <button class="nav-tab" onclick="switchTab('accounts')">👥 All Accounts</button>
            <button class="nav-tab" onclick="switchTab('add')">➕ Add Account</button>
            <button class="nav-tab" onclick="switchTab('analytics')">📊 Analytics</button>
            <button class="nav-tab" onclick="switchTab('export')">📤 Export</button>
        </div>
        
        <div class="tab-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-pane active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Accounts</h3>
                        <div class="value" id="totalAccounts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Accounts</h3>
                        <div class="value" id="activeAccounts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Views</h3>
                        <div class="value" id="totalViews">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Success Rate</h3>
                        <div class="value" id="successRate">0%</div>
                    </div>
                </div>
                
                <div class="grid">
                    <div class="card">
                        <h3>🚀 Quick Actions</h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                            <button class="btn btn-primary" onclick="showAddForm()">➕ Add Account</button>
                            <button class="btn btn-success" onclick="updateAllViews()">🔄 Update Views</button>
                            <button class="btn btn-warning" onclick="checkAccountHealth()">🔍 Health Check</button>
                            <button class="btn" onclick="generateReport()">📊 Generate Report</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>📅 Today's Activity</h3>
                        <div id="todayActivity" style="margin-top: 15px;">
                            <p>No activity recorded today</p>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <h3>📈 Top Performing Accounts</h3>
                    <div id="topPerformers">
                        <p>No account data yet</p>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <h3>⚠️ Needs Attention</h3>
                    <div id="needsAttention">
                        <p>All accounts are healthy! ✅</p>
                    </div>
                </div>
            </div>
            
            <!-- All Accounts Tab -->
            <div id="accounts" class="tab-pane">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>👥 All Accounts</h3>
                        <div>
                            <input type="text" id="searchAccounts" placeholder="Search accounts..." style="padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; margin-right: 10px;">
                            <button class="btn btn-primary" onclick="showAddForm()">➕ Add Account</button>
                        </div>
                    </div>
                    
                    <div class="filter-buttons" style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn" onclick="filterAccounts('all')">All</button>
                        <button class="btn" onclick="filterAccounts('active')">Active</button>
                        <button class="btn" onclick="filterAccounts('suspended')">Suspended</button>
                        <button class="btn" onclick="filterAccounts('warmup')">Warm-up</button>
                        <button class="btn" onclick="filterAccounts('inactive')">Inactive</button>
                    </div>
                    
                    <div id="accountsList">
                        <p>No accounts added yet. Add your first account to get started!</p>
                    </div>
                </div>
            </div>
            
            <!-- Add Account Tab -->
            <div id="add" class="tab-pane">
                <div class="card">
                    <h3>➕ Add New Account</h3>
                    <div class="form-group">
                        <label>Account Username:</label>
                        <input type="text" id="username" placeholder="e.g., @tiny_bella">
                    </div>
                    
                    <div class="form-group">
                        <label>Agency:</label>
                        <select id="agency">
                            <option value="">-- Select Agency --</option>
                            <option value="agency1">Agency 1</option>
                            <option value="agency2">Agency 2</option>
                            <option value="agency3">Agency 3</option>
                            <option value="agency4">Agency 4</option>
                            <option value="agency5">Agency 5</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Posting Method:</label>
                        <select id="method">
                            <option value="spam">SPAM Method</option>
                            <option value="3text1pic">3Text-1Pic Method</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Status:</label>
                        <select id="status">
                            <option value="active">Active</option>
                            <option value="warmup">Warm-up</option>
                            <option value="suspended">Suspended</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Current Views:</label>
                        <input type="number" id="views" value="0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>Creation Date:</label>
                        <input type="date" id="createdDate" value="<?php echo date('Y-m-d'); ?>">
                    </div>
                    
                    <div class="form-group">
                        <label>Notes:</label>
                        <textarea id="notes" rows="3" placeholder="Any special notes about this account..."></textarea>
                    </div>
                    
                    <button class="btn btn-primary" onclick="addAccount()">💾 Save Account</button>
                    <button class="btn" onclick="clearForm()">🗑️ Clear Form</button>
                </div>
            </div>
            
            <!-- Analytics Tab -->
            <div id="analytics" class="tab-pane">
                <div class="grid">
                    <div class="card">
                        <h3>📊 Performance Overview</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h3>Avg. Views/Account</h3>
                                <div class="value" id="avgViews">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Best Account</h3>
                                <div class="value" id="bestAccount">-</div>
                            </div>
                            <div class="stat-card">
                                <h3>Weekly Growth</h3>
                                <div class="value" id="weeklyGrowth">0%</div>
                            </div>
                            <div class="stat-card">
                                <h3>Suspension Rate</h3>
                                <div class="value" id="suspensionRate">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>📈 Views Distribution</h3>
                        <div id="viewsDistribution" style="margin-top: 15px;">
                            <p>No data available</p>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <h3>🏢 Performance by Agency</h3>
                    <div id="agencyPerformance">
                        <p>No agency data available</p>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <h3>📅 Daily Views Trend</h3>
                    <div id="dailyTrend" style="margin-top: 15px;">
                        <p>No trend data available</p>
                    </div>
                </div>
            </div>
            
            <!-- Export Tab -->
            <div id="export" class="tab-pane">
                <div class="card">
                    <h3>📤 Export Data</h3>
                    <div class="form-group">
                        <label>Export Format:</label>
                        <select id="exportFormat">
                            <option value="csv">CSV</option>
                            <option value="json">JSON</option>
                            <option value="text">Text Report</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Data to Include:</label>
                        <div>
                            <label><input type="checkbox" id="exportBasic" checked> Basic Account Info</label><br>
                            <label><input type="checkbox" id="exportViews" checked> Views Data</label><br>
                            <label><input type="checkbox" id="exportPerformance"> Performance Metrics</label><br>
                            <label><input type="checkbox" id="exportNotes"> Notes</label>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="exportData()">📥 Export Data</button>
                    <button class="btn btn-success" onclick="backupData()">💾 Backup All Data</button>
                    <button class="btn btn-warning" onclick="restoreData()">🔄 Restore Backup</button>
                    
                    <div id="exportOutput" style="margin-top: 20px; display: none;">
                        <textarea id="exportData" rows="10" style="width: 100%; padding: 10px; border: 1px solid #D1D5DB; border-radius: 6px;"></textarea>
                        <button class="btn" onclick="copyExportData()" style="margin-top: 10px;">📋 Copy to Clipboard</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Account Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>✏️ Edit Account</h3>
            <div class="form-group">
                <label>Account Username:</label>
                <input type="text" id="editUsername">
            </div>
            
            <div class="form-group">
                <label>Agency:</label>
                <select id="editAgency">
                    <option value="agency1">Agency 1</option>
                    <option value="agency2">Agency 2</option>
                    <option value="agency3">Agency 3</option>
                    <option value="agency4">Agency 4</option>
                    <option value="agency5">Agency 5</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Status:</label>
                <select id="editStatus">
                    <option value="active">Active</option>
                    <option value="warmup">Warm-up</option>
                    <option value="suspended">Suspended</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Current Views:</label>
                <input type="number" id="editViews" min="0">
            </div>
            
            <div class="form-group">
                <label>Notes:</label>
                <textarea id="editNotes" rows="3"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveEdit()">💾 Save Changes</button>
                <button class="btn" style="background: #6B7280; color: white;" onclick="hideModal('editModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Account Tracker Class
        class AccountTracker {
            constructor() {
                this.accounts = JSON.parse(localStorage.getItem('tracker_accounts')) || [];
                this.viewHistory = JSON.parse(localStorage.getItem('tracker_view_history')) || {};
                this.init();
            }

            init() {
                this.updateDashboard();
                this.renderAccounts();
                this.updateAnalytics();
            }

            updateDashboard() {
                // Update stats
                document.getElementById('totalAccounts').textContent = this.accounts.length;
                
                const activeAccounts = this.accounts.filter(acc => acc.status === 'active').length;
                document.getElementById('activeAccounts').textContent = activeAccounts;
                
                const totalViews = this.accounts.reduce((sum, acc) => sum + (acc.views || 0), 0);
                document.getElementById('totalViews').textContent = totalViews.toLocaleString();
                
                const successRate = this.accounts.length > 0 ? 
                    Math.round((activeAccounts / this.accounts.length) * 100) : 0;
                document.getElementById('successRate').textContent = successRate + '%';
                
                this.updateTodayActivity();
                this.updateTopPerformers();
                this.updateNeedsAttention();
            }

            updateTodayActivity() {
                const today = new Date().toDateString();
                const todayActivities = [];
                
                // Check for accounts created today
                const newToday = this.accounts.filter(acc => 
                    new Date(acc.createdDate).toDateString() === today
                ).length;
                
                if (newToday > 0) {
                    todayActivities.push(`➕ ${newToday} new accounts created`);
                }
                
                // Check for status changes today
                const statusChanges = this.accounts.filter(acc => 
                    acc.lastStatusChange === today
                ).length;
                
                if (statusChanges > 0) {
                    todayActivities.push(`🔄 ${statusChanges} status updates`);
                }
                
                const container = document.getElementById('todayActivity');
                if (todayActivities.length === 0) {
                    container.innerHTML = '<p>No activity recorded today</p>';
                } else {
                    container.innerHTML = todayActivities.map(activity => `<p>${activity}</p>`).join('');
                }
            }

            updateTopPerformers() {
                const container = document.getElementById('topPerformers');
                const topAccounts = this.accounts
                    .filter(acc => acc.status === 'active')
                    .sort((a, b) => (b.views || 0) - (a.views || 0))
                    .slice(0, 5);
                
                if (topAccounts.length === 0) {
                    container.innerHTML = '<p>No account data yet</p>';
                    return;
                }

                container.innerHTML = topAccounts.map(account => `
                    <div class="account-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${account.username}</strong>
                                <span class="view-badge">${account.views?.toLocaleString() || 0} views</span>
                            </div>
                            <div style="font-size: 12px; color: #6B7280;">
                                ${account.agency} • ${account.method}
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${this.calculateProgress(account.views)}%"></div>
                        </div>
                    </div>
                `).join('');
            }

            calculateProgress(views) {
                // Progress towards 1000 views
                return Math.min((views / 1000) * 100, 100);
            }

            updateNeedsAttention() {
                const container = document.getElementById('needsAttention');
                const needsAttention = this.accounts.filter(acc => 
                    acc.status === 'suspended' || 
                    (acc.status === 'active' && (acc.views || 0) < 50) ||
                    acc.status === 'warmup'
                );
                
                if (needsAttention.length === 0) {
                    container.innerHTML = '<p>All accounts are healthy! ✅</p>';
                    return;
                }

                container.innerHTML = needsAttention.map(account => {
                    let issue = '';
                    if (account.status === 'suspended') issue = '🚨 Suspended';
                    else if (account.status === 'warmup') issue = '🔥 Needs warm-up';
                    else if ((account.views || 0) < 50) issue = '📉 Low views';
                    
                    return `
                        <div class="account-card ${account.status}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${account.username}</strong>
                                    <span style="color: var(--danger); font-size: 12px;">${issue}</span>
                                </div>
                                <div class="account-actions">
                                    <button class="btn" onclick="editAccount('${account.id}')">Edit</button>
                                    <button class="btn btn-warning" onclick="updateAccountViews('${account.id}')">Update</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderAccounts(filter = 'all') {
                const container = document.getElementById('accountsList');
                const searchTerm = document.getElementById('searchAccounts')?.value.toLowerCase() || '';
                
                let filteredAccounts = this.accounts;
                
                // Apply search filter
                if (searchTerm) {
                    filteredAccounts = filteredAccounts.filter(acc => 
                        acc.username.toLowerCase().includes(searchTerm) ||
                        acc.agency.toLowerCase().includes(searchTerm)
                    );
                }
                
                // Apply status filter
                if (filter !== 'all') {
                    filteredAccounts = filteredAccounts.filter(acc => acc.status === filter);
                }
                
                if (filteredAccounts.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #6B7280;">
                            <h3>No accounts found</h3>
                            <p>${searchTerm ? 'Try a different search term' : 'Add your first account to get started'}</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredAccounts.map(account => {
                    const statusClass = `status-${account.status}`;
                    const cardClass = `account-card ${account.status}`;
                    
                    return `
                        <div class="${cardClass}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                        <strong>${account.username}</strong>
                                        <span class="status-badge ${statusClass}">${account.status}</span>
                                        <span class="view-badge">${account.views?.toLocaleString() || 0} views</span>
                                    </div>
                                    <div style="font-size: 12px; color: #6B7280;">
                                        ${account.agency} • ${account.method} • Created: ${new Date(account.createdDate).toLocaleDateString()}
                                    </div>
                                    ${account.notes ? `<div style="font-size: 11px; color: #6B7280; margin-top: 5px;">${account.notes}</div>` : ''}
                                </div>
                                <div class="account-actions">
                                    <button class="btn" onclick="editAccount('${account.id}')">✏️</button>
                                    <button class="btn btn-warning" onclick="updateAccountViews('${account.id}')">🔄</button>
                                    <button class="btn btn-danger" onclick="deleteAccount('${account.id}')">🗑️</button>
                                </div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${this.calculateProgress(account.views)}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            addAccount(accountData) {
                const newAccount = {
                    id: Date.now().toString(),
                    ...accountData,
                    createdDate: accountData.createdDate || new Date().toISOString().split('T')[0],
                    lastUpdated: new Date().toISOString()
                };
                
                this.accounts.push(newAccount);
                this.saveData();
                this.updateDashboard();
                this.renderAccounts();
                this.updateAnalytics();
                
                return newAccount;
            }

            editAccount(accountId, updates) {
                const accountIndex = this.accounts.findIndex(acc => acc.id === accountId);
                if (accountIndex !== -1) {
                    this.accounts[accountIndex] = {
                        ...this.accounts[accountIndex],
                        ...updates,
                        lastUpdated: new Date().toISOString(),
                        lastStatusChange: updates.status !== this.accounts[accountIndex].status ? 
                            new Date().toDateString() : this.accounts[accountIndex].lastStatusChange
                    };
                    this.saveData();
                    this.updateDashboard();
                    this.renderAccounts();
                    this.updateAnalytics();
                    return true;
                }
                return false;
            }

            deleteAccount(accountId) {
                this.accounts = this.accounts.filter(acc => acc.id !== accountId);
                this.saveData();
                this.updateDashboard();
                this.renderAccounts();
                this.updateAnalytics();
            }

            updateAnalytics() {
                // Average views
                const avgViews = this.accounts.length > 0 ? 
                    Math.round(this.accounts.reduce((sum, acc) => sum + (acc.views || 0), 0) / this.accounts.length) : 0;
                document.getElementById('avgViews').textContent = avgViews.toLocaleString();
                
                // Best account
                const bestAccount = this.accounts.reduce((best, acc) => 
                    (acc.views || 0) > (best.views || 0) ? acc : best, {views: 0});
                document.getElementById('bestAccount').textContent = bestAccount.username || '-';
                
                // Suspension rate
                const suspendedCount = this.accounts.filter(acc => acc.status === 'suspended').length;
                const suspensionRate = this.accounts.length > 0 ? 
                    Math.round((suspendedCount / this.accounts.length) * 100) : 0;
                document.getElementById('suspensionRate').textContent = suspensionRate + '%';
                
                this.renderAgencyPerformance();
                this.renderViewsDistribution();
            }

            renderAgencyPerformance() {
                const container = document.getElementById('agencyPerformance');
                const agencies = [...new Set(this.accounts.map(acc => acc.agency))];
                
                if (agencies.length === 0) {
                    container.innerHTML = '<p>No agency data available</p>';
                    return;
                }

                const agencyStats = agencies.map(agency => {
                    const agencyAccounts = this.accounts.filter(acc => acc.agency === agency);
                    const activeAccounts = agencyAccounts.filter(acc => acc.status === 'active').length;
                    const totalViews = agencyAccounts.reduce((sum, acc) => sum + (acc.views || 0), 0);
                    const avgViews = agencyAccounts.length > 0 ? Math.round(totalViews / agencyAccounts.length) : 0;
                    
                    return { agency, accounts: agencyAccounts.length, active: activeAccounts, avgViews };
                });

                container.innerHTML = agencyStats.map(stat => `
                    <div class="performance-chart">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong>${stat.agency}</strong>
                            <span>${stat.active}/${stat.accounts} active</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(stat.active / stat.accounts) * 100}%"></div>
                        </div>
                        <div style="font-size: 12px; color: #6B7280; text-align: center;">
                            Avg: ${stat.avgViews.toLocaleString()} views
                        </div>
                    </div>
                `).join('');
            }

            renderViewsDistribution() {
                const container = document.getElementById('viewsDistribution');
                const ranges = [
                    { label: '0-100', min: 0, max: 100 },
                    { label: '101-500', min: 101, max: 500 },
                    { label: '501-1000', min: 501, max: 1000 },
                    { label: '1000+', min: 1001, max: Infinity }
                ];
                
                const distribution = ranges.map(range => {
                    const count = this.accounts.filter(acc => 
                        (acc.views || 0) >= range.min && (acc.views || 0) <= range.max
                    ).length;
                    return { ...range, count };
                });

                container.innerHTML = distribution.map(item => `
                    <div style="margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${item.label} views</span>
                            <span>${item.count} accounts</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(item.count / this.accounts.length) * 100}%"></div>
                        </div>
                    </div>
                `).join('');
            }

            exportData(format) {
                const includeBasic = document.getElementById('exportBasic').checked;
                const includeViews = document.getElementById('exportViews').checked;
                const includePerformance = document.getElementById('exportPerformance').checked;
                const includeNotes = document.getElementById('exportNotes').checked;
                
                let exportData;
                
                switch (format) {
                    case 'csv':
                        exportData = this.exportToCSV(includeBasic, includeViews, includePerformance, includeNotes);
                        break;
                    case 'json':
                        exportData = this.exportToJSON(includeBasic, includeViews, includePerformance, includeNotes);
                        break;
                    case 'text':
                        exportData = this.exportToText(includeBasic, includeViews, includePerformance, includeNotes);
                        break;
                }
                
                document.getElementById('exportData').value = exportData;
                document.getElementById('exportOutput').style.display = 'block';
            }

            exportToCSV(basic, views, performance, notes) {
                const headers = [];
                if (basic) headers.push('Username', 'Agency', 'Method', 'Status', 'Created Date');
                if (views) headers.push('Views');
                if (notes) headers.push('Notes');
                
                const rows = this.accounts.map(account => {
                    const row = [];
                    if (basic) row.push(account.username, account.agency, account.method, account.status, account.createdDate);
                    if (views) row.push(account.views || 0);
                    if (notes) row.push(account.notes || '');
                    return row;
                });
                
                return [headers, ...rows].map(row => row.join(',')).join('\n');
            }

            exportToJSON(basic, views, performance, notes) {
                const exportAccounts = this.accounts.map(account => {
                    const exported = {};
                    if (basic) {
                        exported.username = account.username;
                        exported.agency = account.agency;
                        exported.method = account.method;
                        exported.status = account.status;
                        exported.createdDate = account.createdDate;
                    }
                    if (views) exported.views = account.views || 0;
                    if (notes) exported.notes = account.notes || '';
                    return exported;
                });
                
                return JSON.stringify(exportAccounts, null, 2);
            }

            exportToText(basic, views, performance, notes) {
                let text = `ACCOUNT TRACKER REPORT - ${new Date().toLocaleDateString()}\n\n`;
                text += `Total Accounts: ${this.accounts.length}\n`;
                text += `Active Accounts: ${this.accounts.filter(acc => acc.status === 'active').length}\n`;
                text += `Total Views: ${this.accounts.reduce((sum, acc) => sum + (acc.views || 0), 0).toLocaleString()}\n\n`;
                
                this.accounts.forEach(account => {
                    text += `Username: ${account.username}\n`;
                    if (basic) text += `Agency: ${account.agency} | Method: ${account.method} | Status: ${account.status}\n`;
                    if (views) text += `Views: ${(account.views || 0).toLocaleString()}\n`;
                    if (notes && account.notes) text += `Notes: ${account.notes}\n`;
                    text += '─'.repeat(50) + '\n';
                });
                
                return text;
            }

            backupData() {
                const backup = {
                    accounts: this.accounts,
                    viewHistory: this.viewHistory,
                    backupDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `account-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('Backup created successfully! 💾', 'success');
            }

            saveData() {
                localStorage.setItem('tracker_accounts', JSON.stringify(this.accounts));
                localStorage.setItem('tracker_view_history', JSON.stringify(this.viewHistory));
            }

            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.background = type === 'success' ? '#10B981' : type === 'warning' ? '#F59E0B' : '#EF4444';
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
        }

        // Global functions
        let accountTracker;
        let currentEditId = null;

        function switchTab(tabName) {
            document.querySelectorAll('.tab-pane').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(button => button.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showAddForm() {
            switchTab('add');
        }

        function addAccount() {
            const username = document.getElementById('username').value;
            const agency = document.getElementById('agency').value;
            const method = document.getElementById('method').value;
            const status = document.getElementById('status').value;
            const views = parseInt(document.getElementById('views').value) || 0;
            const createdDate = document.getElementById('createdDate').value;
            const notes = document.getElementById('notes').value;
            
            if (!username || !agency) {
                accountTracker.showNotification('Please fill all required fields', 'danger');
                return;
            }
            
            accountTracker.addAccount({
                username,
                agency,
                method,
                status,
                views,
                createdDate,
                notes
            });
            
            clearForm();
            accountTracker.showNotification('Account added successfully! 👥', 'success');
        }

        function clearForm() {
            document.getElementById('username').value = '';
            document.getElementById('views').value = '0';
            document.getElementById('notes').value = '';
        }

        function editAccount(accountId) {
            const account = accountTracker.accounts.find(acc => acc.id === accountId);
            if (account) {
                currentEditId = accountId;
                document.getElementById('editUsername').value = account.username;
                document.getElementById('editAgency').value = account.agency;
                document.getElementById('editStatus').value = account.status;
                document.getElementById('editViews').value = account.views || 0;
                document.getElementById('editNotes').value = account.notes || '';
                document.getElementById('editModal').style.display = 'flex';
            }
        }

        function saveEdit() {
            if (!currentEditId) return;
            
            const updates = {
                username: document.getElementById('editUsername').value,
                agency: document.getElementById('editAgency').value,
                status: document.getElementById('editStatus').value,
                views: parseInt(document.getElementById('editViews').value) || 0,
                notes: document.getElementById('editNotes').value
            };
            
            if (accountTracker.editAccount(currentEditId, updates)) {
                hideModal('editModal');
                accountTracker.showNotification('Account updated successfully! ✏️', 'success');
            }
        }

        function deleteAccount(accountId) {
            if (confirm('Are you sure you want to delete this account?')) {
                accountTracker.deleteAccount(accountId);
                accountTracker.showNotification('Account deleted successfully', 'success');
            }
        }

        function updateAccountViews(accountId) {
            const newViews = prompt('Enter new views count:');
            if (newViews !== null) {
                const views = parseInt(newViews) || 0;
                accountTracker.editAccount(accountId, { views });
                accountTracker.showNotification('Views updated successfully! 🔄', 'success');
            }
        }

        function updateAllViews() {
            accountTracker.accounts.forEach(account => {
                if (account.status === 'active') {
                    // Simulate view growth (in real use, you'd input actual numbers)
                    const growth = Math.floor(Math.random() * 50) + 10;
                    accountTracker.editAccount(account.id, { 
                        views: (account.views || 0) + growth 
                    });
                }
            });
            accountTracker.showNotification('All views updated! 📈', 'success');
        }

        function filterAccounts(status) {
            accountTracker.renderAccounts(status);
        }

        function checkAccountHealth() {
            const suspended = accountTracker.accounts.filter(acc => acc.status === 'suspended').length;
            const lowViews = accountTracker.accounts.filter(acc => 
                acc.status === 'active' && (acc.views || 0) < 50
            ).length;
            
            if (suspended > 0 || lowViews > 0) {
                accountTracker.showNotification(`Found ${suspended} suspended and ${lowViews} low-view accounts`, 'warning');
            } else {
                accountTracker.showNotification('All accounts are healthy! ✅', 'success');
            }
        }

        function generateReport() {
            switchTab('export');
            accountTracker.exportData('text');
        }

        function exportData() {
            const format = document.getElementById('exportFormat').value;
            accountTracker.exportData(format);
        }

        function backupData() {
            accountTracker.backupData();
        }

        function copyExportData() {
            const exportData = document.getElementById('exportData');
            exportData.select();
            document.execCommand('copy');
            accountTracker.showNotification('Data copied to clipboard! 📋', 'success');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            currentEditId = null;
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchAccounts');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    accountTracker.renderAccounts();
                });
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            accountTracker = new AccountTracker();
        });

        // Modal background click to close
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                currentEditId = null;
            }
        }
    </script>
</body>
</html>